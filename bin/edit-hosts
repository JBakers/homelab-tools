#!/bin/bash
set -euo pipefail

# Edit SSH host configuration
# Author: J.Bakers
# Version: 3.5.0-dev.4

# Kleuren
CYAN='\033[0;36m'
GREEN='\033[0;32m'
YELLOW='\033[1;33m'
RED='\033[0;31m'
BOLD='\033[1m'
RESET='\033[0m'

SSH_CONFIG="$HOME/.ssh/config"

show_help() {
    echo -e "${BOLD}${CYAN}edit-hosts - Edit host configuration${RESET}"
    echo ""
    echo -e "${BOLD}USAGE:${RESET}"
    echo "  edit-hosts"
    echo ""
    echo -e "${BOLD}DESCRIPTION:${RESET}"
    echo "  Opens your host configuration file in your default editor."
    echo "  Creates the file if it doesn't exist."
    echo ""
    echo -e "${BOLD}FILE LOCATION:${RESET}"
    echo "  ~/.ssh/config"
    echo ""
    echo -e "${BOLD}EXAMPLE ENTRY:${RESET}"
    echo "  Host jellyfin"
    echo "    HostName 192.168.1.25"
    echo "    User root"
    echo "    Port 22"
    echo ""
    echo -e "${BOLD}TIP:${RESET}"
    echo "  After editing, use ${GREEN}bulk-generate-motd${RESET} to create"
    echo "  MOTDs for all hosts automatically."
    echo ""
}

if [[ "${1:-}" == "--help" ]] || [[ "${1:-}" == "-h" ]]; then
    show_help
    exit 0
fi

echo -e "${BOLD}${CYAN}╔══════════════════════════════════════════════════════════╗"
echo -e "║         ⚙️  Host Configuration Editor                    ║"
echo -e "╚══════════════════════════════════════════════════════════╝${RESET}"
echo ""

# Maak .ssh directory als die niet bestaat
if [[ ! -d "$HOME/.ssh" ]]; then
    echo -e "${YELLOW}→${RESET} Creating ~/.ssh directory..."
    mkdir -p "$HOME/.ssh"
    chmod 700 "$HOME/.ssh"
fi

# Maak config als die niet bestaat
if [[ ! -f "$SSH_CONFIG" ]]; then
    echo -e "${YELLOW}→${RESET} Creating new host configuration file..."
    cat > "$SSH_CONFIG" << 'EOF'
# SSH Configuration
# Add your homelab hosts here

# Example:
# Host jellyfin
#   HostName 192.168.1.25
#   User root
#   Port 22

EOF
    chmod 600 "$SSH_CONFIG"
fi

echo -e "${BOLD}File:${RESET} ${CYAN}$SSH_CONFIG${RESET}"
echo ""

# Bepaal editor (nano default, tenzij EDITOR expliciet is ingesteld)
EDITOR="${EDITOR:-nano}"

echo -e "${YELLOW}→${RESET} Opening in ${GREEN}$EDITOR${RESET}..."
echo ""

# Open editor
$EDITOR "$SSH_CONFIG"

echo ""
echo -e "${GREEN}✓ host configuration saved${RESET}"
echo ""
echo -e "${YELLOW}Next steps:${RESET}"
echo -e "  ${GREEN}bulk-generate-motd${RESET}  - Generate MOTDs for all hosts"
echo -e "  ${GREEN}list-templates${RESET}      - View generated templates"
echo ""
